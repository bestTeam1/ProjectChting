<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.team1.chting.dao.HomeDao">

    <select id="getNewGroupList" resultType="com.team1.chting.dto.GroupDto">
        select gi.group_no, gi.group_name, gi.group_img, ic.catename, a.area_name, gi.content
        from user_info u
                 left join group_info gi on u.first_area = gi.area_code or u.second_area = gi.area_code
                 left join (select gi.group_no
                            from user_interest ui
                                     join group_info gi on ui.catecode = gi.catecode
                            where ui.userid = 'testuser002')uint on gi.group_no = uint.group_no
                 join interest_category ic on gi.catecode = ic.catecode
                 join area a on gi.area_code = a.area_code
        where u.enabled = 1 and gi.enabled = 1 and u.userid = 'testuser002'
        order by gi.opendate desc limit 8
    </select>

    <select id="getBestGroupList" resultType="com.team1.chting.dto.GroupDto">
        select gi.group_no, gi.group_name, gi.group_img, ic.catename, a.area_name, gi.content, pg.cnt
        from user_info u
                 left join group_info gi on u.first_area = gi.area_code or u.second_area = gi.area_code
                 left join (select gi.group_no
                            from user_interest ui
                                     join group_info gi on ui.catecode = gi.catecode
                            where ui.userid = 'testuser002'
        )uint on gi.group_no = uint.group_no
                 left join (select group_no, count(post_no)as cnt from post_group group by group_no)pg on gi.group_no = pg.group_no
                 join interest_category ic on gi.catecode = ic.catecode
                 join area a on gi.area_code = a.area_code
        where u.enabled = 1 and gi.enabled = 1 and u.userid = 'testuser002'
        order by pg.cnt desc limit 8
    </select>


</mapper>

