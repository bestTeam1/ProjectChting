<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.team1.chting.dao.UserDao">
    <!-- 회원 기본 정보   -->
    <select id="selectUserInfo" resultType="com.team1.chting.dto.UserDto">
        select u.userid, u.nickname, u.profile_img, a.area_name as first_area_name, b.area_name as second_area_name, u.content, gur.cnt
        from user_info u
                 join area a on u.first_area = a.area_code
                 join area b on u.second_area = b.area_code
                 left join (
            select userid, count(group_role_no) as cnt
            from group_user_role
            where userid = #{userid} and group_role_no = 1
            group by group_role_no
        )gur on u.userid = gur.userid
        where u.userid = #{userid}
    </select>

    <!-- 회원이 선택한 관심사 -->
    <select id="selectUserInterest" resultType="com.team1.chting.dto.UserDto">
        select u.userid, ic.catename
        from user_info u
                 join user_interest ui on u.userid = ui.userid
                 join interest_category ic on ui.catecode = ic.catecode
        where u.userid = #{userid}
        order by ic.catename
    </select>

    <!-- 회원 참여 모임 정보   -->
    <select id="selectUserJoinGroup" resultType="com.team1.chting.dto.UserDto">
        select u.userid, gi.group_name, gi.group_no
        from user_info u
                 join group_user_role gur on u.userid = gur.userid
                 join group_info gi on gur.group_no = gi.group_no
        where gi.enabled = 1 and u.userid = #{userid}
        order by gi.group_name
    </select>

    <!-- 회원 탈퇴 -->
    <delete id="deleteAcount">
        update user_info
        set enabled = 0, userid = CONCAT(userid, 'del')
        where userid = #{userid}
    </delete>

    <!--  회원 정보 수정  -->
    <update id="updateUser">
        update user_info
        set first_area = #{first_area}, second_area = #{second_area}, content = #{content}, profile_img = #{profile_img}
        where userid = #{userid}
    </update>

    <!--  회원 닉네임 조회  -->
    <select id="selectNickname" resultType="String">
        select nickname from user_info where userid = #{userid}
    </select>

    <!--  회원이 선택한 지역  -->
    <select id="selectAreacode" resultType="com.team1.chting.dto.UserDto">
        select first_area, second_area
        from user_info
        where userid = #{userid}
    </select>
</mapper>