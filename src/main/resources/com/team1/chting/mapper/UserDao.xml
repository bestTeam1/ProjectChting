<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.team1.chting.dao.UserDao">
    <select id="selectUserInfo" resultType="com.team1.chting.dto.UserDto">
        select u.userid, u.nickname, a.area_name as first_area_name, b.area_name as second_area_name, u.content, gur.cnt
        from user_info u
                 join area a on u.first_area = a.area_code
                 join area b on u.second_area = b.area_code
                 left join (
            select userid, count(group_role_no) as cnt
            from group_user_role
            where userid = #{userid} and group_role_no = 1
            group by group_role_no
        )gur on u.userid = gur.userid
        where u.userid = #{userid}
    </select>

    <select id="selectUserInterest" resultType="com.team1.chting.dto.UserDto">
        select u.userid, ic.catename
        from user_info u
                 join user_interest ui on u.userid = ui.userid
                 join interest_category ic on ui.s_catecode = ic.catecode
        where u.userid = #{userid}
        order by ic.catename
    </select>

    <select id="selectUserJoinGroup" resultType="com.team1.chting.dto.UserDto">
        select u.userid, gi.group_name
        from user_info u
                 join group_user_role gur on u.userid = gur.userid
                 join group_info gi on gur.group_no = gi.group_no
        where u.userid = #{userid}
        order by gi.group_name
    </select>

    <update id="deleteAcount">
        update user_info
        set enabled = 0
        where userid = #{userid}
    </update>

    <update id="updateUser">
        update user_info
        set first_area = #{first_area}, second_area = #{second_area}, content = #{content}
        where userid = #{userid}
    </update>

    <select id="selectNickname" resultType="String">
        select nickname from user_info where userid = #{userid};
    </select>

    <!-- 모임장으로 속한 그룹 정보 -->
    <select id="getAdminGroup" resultType="com.team1.chting.dto.GroupDto">
        select group_no, group_name, group_img, catename, area_name, content
        from group_info
                 left join area a on group_info.area_code = a.area_code
                 left join interest_category ic on group_info.catecode = ic.catecode
        where enabled = 1 and group_no = #{groupNo}
    </select>
    <!-- 모임원으로 속한 그룹정보 -->
    <select id="getGroupList" resultType="com.team1.chting.dto.GroupDto">
        select gur.group_no, group_name, group_img, catename, area_name, content
        from group_info
                 left join area a on group_info.area_code = a.area_code
                 left join interest_category ic on group_info.catecode = ic.catecode
                 left join group_user_role gur on group_info.group_no = gur.group_no
        where enabled = 1 and group_role_no = "2" and gur.userid = #{userid}
    </select>

</mapper>